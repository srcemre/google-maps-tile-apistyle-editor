<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Map Style Explorer</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha2d1-sP3/azT7A1S3uB49X4d34Vw/kL/nFp3d/jE9G7iQ8QeM1A/pE+J9K+33D3L5G4A==" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <!-- External CSS -->
    <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body class="bg-gray-50 flex h-screen text-gray-800">
    
    <!-- Left Sidebar: Controls -->
    <div id="control-panel"
        class="w-full md:w-96 bg-white border-r border-gray-200 shadow-2xl p-5 flex flex-col z-30 transition-transform duration-300 transform md:translate-x-0 -translate-x-full absolute md:relative h-full overflow-y-auto">
        <header class="mb-5 border-b pb-3">
            <h1 class="text-2xl font-bold text-gray-900 tracking-tight">
                Style Explorer
            </h1>
            <p class="text-xs text-gray-500 mt-1">
                Discover hidden Google Maps styles
            </p>
        </header>

        <!-- APISTYLE INPUT -->
        <div class="mb-5 bg-blue-50 p-3 rounded-lg border border-blue-100">
            <label for="apistyle-input"
                class="block text-xs font-bold text-blue-800 uppercase tracking-wider mb-2 flex items-center">
                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                </svg>
                Apistyle Parameter
            </label>
            <textarea id="apistyle-input" rows="3"
                class="w-full p-2 border border-blue-200 rounded text-xs font-mono bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none resize-none shadow-sm"
                placeholder="Paste style string here (s.t:3|...)"></textarea>
            <p class="text-[10px] text-blue-400 mt-1 text-right">
                Accepts raw or URL-encoded strings.
            </p>
        </div>

        <!-- Map Layer Selection -->
        <div class="mb-5">
            <label for="layer-select" class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Base
                Layer (Lyrs)</label>
            <div class="relative">
                <select id="layer-select"
                    class="w-full p-2.5 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block">
                    <option value="m">m (Standard Map)</option>
                    <option value="p">p (Terrain - Best for Custom)</option>
                    <option value="r">r (Roadmap)</option>
                    <option value="s">s (Satellite - No Style)</option>
                    <option value="y">y (Hybrid - No Style)</option>
                    <option value="h">h (Roads Only)</option>
                </select>
            </div>
        </div>

        <!-- ZOOM LEVEL CONTROL -->
        <div class="mb-5">
            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 flex justify-between">
                Zoom Level
                <span id="zoom-display" class="text-indigo-600 font-mono">13</span>
            </label>
            <input type="range" id="zoom-level-control" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="2" max="20" value="13">
            <div class="flex justify-between text-[10px] text-gray-400 mt-1">
                <span>World</span>
                <span>City</span>
                <span>Street</span>
            </div>
        </div>

        <!-- VISUAL EDITOR TOGGLE BUTTON -->
        <div class="mb-5">
            <button id="toggle-visual-editor-btn" 
                class="w-full flex items-center justify-between p-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-all transform active:scale-95 group">
                <span class="flex items-center font-semibold text-sm">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                    Advanced Style Editor
                </span>
                <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
            <p class="text-[10px] text-gray-400 mt-1 ml-1">Create custom rules visually.</p>
        </div>

        <!-- Visual Preset Selector -->
        <div class="mb-5">
            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Fantasy & Gaming
                Presets</label>
            <div class="grid grid-cols-1 gap-2" id="preset-list-gaming">
                <!-- GTA San Andreas -->
                <button
                    class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-yellow-50 hover:border-yellow-300 group text-left relative overflow-hidden"
                    data-layer="p"
                    data-style="s.t:0|s.e:l|p.v:off,s.t:5|s.e:g|p.c:#ffe8ddc0|p.s:-30|p.l:10,s.t:6|s.e:g|p.c:#ff2d5d5d|p.s:-20,s.t:40|s.e:g|p.c:#ff5a7d2b,s.t:3|s.e:g|p.c:#ff111111|p.w:2,s.t:50|s.e:g|p.c:#ffddb85a|p.w:3">
                    <div
                        class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-gradient-to-br from-orange-200 to-yellow-700 border border-gray-300">
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-700 group-hover:text-yellow-700">
                            GTA: San Andreas
                        </div>
                        <div class="text-[10px] text-gray-400">
                            Sepia tone, retro feel.
                        </div>
                    </div>
                </button>

                <!-- The Witcher (TRUE NOVIGRAD STYLE - FIXED NUMERIC IDs) -->
                <button class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-red-50 hover:border-red-300 group text-left"
                    data-layer="m" 
                    data-style="s.t:0|s.e:l|p.v:off,s.t:6|p.c:#526b68,s.t:5|p.c:#7d705e,s.t:81|s.e:g.f|p.c:#9e3527,s.t:81|s.e:g.s|p.c:#7d705e,s.t:40|s.e:g|p.c:#535e42,s.t:3|s.e:g|p.c:#968870|p.w:1.5">
                    <div class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-[#7d705e] border-2 border-[#9e3527] relative overflow-hidden">
                        <!-- Red Building block representation -->
                        <div class="absolute top-2 left-2 w-4 h-4 bg-[#9e3527]"></div>
                        <!-- Water -->
                        <div class="absolute bottom-0 left-0 w-full h-2 bg-[#526b68]"></div>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-700 group-hover:text-red-800">
                            The Witcher
                        </div>
                        <div class="text-[10px] text-gray-400">Numeric IDs: Red buildings, earth soil.</div>
                    </div>
                </button>

                <!-- Fantasy Realm / LOTR -->
                <button
                    class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-orange-50 hover:border-orange-300 group text-left"
                    data-layer="p"
                    data-style="s.t:0|s.e:l|p.v:off,s.t:0|s.e:g|p.c:#ffe8dcb5|p.s:-90|p.l:15,s.t:5|s.e:g|p.c:#ffe8dcb5|p.s:-90|p.l:10,s.t:6|s.e:g|p.c:#ff9db3c7|p.s:-60|p.l:-5,s.t:3|s.e:g|p.c:#ff7a5a2b|p.w:1|p.s:-40,s.t:49|s.e:g|p.c:#ff6a4a1b|p.w:2,s.t:40|s.e:g|p.c:#ffcab890|p.s:-70,s.t:82|s.e:g|p.c:#ffd7c49b|p.s:-80">
                    <div class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-[#e6dac3] border border-[#8b5a2b]">
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-700 group-hover:text-orange-800">
                            Fantasy Realm
                        </div>
                        <div class="text-[10px] text-gray-400">
                            Fantasy map, earthy tones.
                        </div>
                    </div>
                </button>
            </div>

            <!-- Other presets hidden for brevity, but logic remains -->
            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-4">Sci-Fi & Dark</label>
            <div class="grid grid-cols-1 gap-2" id="preset-list-scifi">
                 <!-- Cyberpunk Neon -->
                <button
                    class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-gray-900 hover:border-gray-700 hover:text-white group text-left transition-colors duration-300"
                    data-layer="m"
                    data-style="s.t:0|s.e:l|p.v:off,s.t:5|s.e:g|p.c:#ff000000,s.t:81|s.e:g|p.c:#ff04000f,s.t:82|s.e:g|p.c:#ff000000,s.t:6|s.e:g|p.c:#ff00eaff|p.l:-20,s.t:3|s.e:g|p.c:#ffff00ff|p.w:2,s.t:49|s.e:g|p.c:#ffff00ff|p.w:3,s.t:2|s.e:g|p.c:#ff080808,s.t:40|s.e:g|p.c:#ff00ffaa">
                    <div
                        class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-black border border-pink-500 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1/2 bg-blue-500 opacity-50"></div>
                    </div>
                    <div>
                        <div class="text-sm font-semibold group-hover:text-pink-400 text-gray-800">
                            Cyberpunk Neon
                        </div>
                        <div class="text-[10px] group-hover:text-gray-400 text-gray-400">
                            Black/Pink/Cyan. High tech.
                        </div>
                    </div>
                </button>

                <!-- Hologram -->
                <button
                    class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-indigo-50 hover:border-indigo-300 group text-left"
                    data-layer="m"
                    data-style="s.t:0|s.e:l|p.v:off,s.t:5|s.e:g|p.c:#ff000000,s.t:82|s.e:g|p.c:#ff0a0a1a,s.t:6|s.e:g|p.c:#ff1a3a5f|p.l:-20,s.t:3|s.e:g|p.c:#ff4f7cff|p.w:2,s.t:49|s.e:g|p.c:#ff6f9cff|p.w:3,s.t:2|s.e:g|p.c:#ff111111">
                    <div class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-[#0a0a1a] border border-[#4f7cff]">
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-700 group-hover:text-indigo-700">
                            Hologram
                        </div>
                        <div class="text-[10px] text-gray-400">
                            Hologram table. Neon blue.
                        </div>
                    </div>
                </button>

                <!-- Midnight Commander -->
                <button
                    class="preset-btn flex items-center p-2 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 group text-left"
                    data-layer="m"
                    data-style="s.t:0|s.e:l|p.v:off,s.t:0|p.c:#242f3e,s.t:6|p.c:#17263c,s.t:3|p.c:#38414e,s.t:3|s.e:g|p.c:#746855">
                    <div
                        class="w-10 h-10 rounded-md shadow-sm mr-3 flex-shrink-0 bg-gradient-to-br from-gray-900 to-blue-900 border border-gray-600">
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-700 group-hover:text-blue-700">
                            Midnight
                        </div>
                        <div class="text-[10px] text-gray-400">
                            Dark mode, high contrast.
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Debug URL -->
        <div class="mb-4 bg-yellow-50 p-3 rounded-lg border border-yellow-200 mt-auto">
            <label class="block text-[10px] font-bold text-yellow-800 uppercase mb-1 flex items-center">
                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                Generated URL
            </label>
            <textarea id="debug-url" rows="2" readonly
                class="w-full p-2 text-[10px] font-mono text-gray-600 bg-white border border-gray-200 rounded break-all cursor-pointer focus:ring-1 focus:ring-yellow-400 outline-none"
                onclick="this.select()"></textarea>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <button id="reset-style-btn" class="col-span-1 bg-gray-100 text-gray-600 py-2.5 rounded-lg font-semibold hover:bg-gray-200 transition-colors text-sm">Reset</button>
            <button id="apply-style-btn" class="col-span-1 bg-blue-600 text-white py-2.5 rounded-lg font-semibold hover:bg-blue-700 shadow-lg hover:shadow-xl transition-all text-sm transform active:scale-95">Apply Style</button>
        </div>
    </div>

    <!-- NEW: SLIDE-OUT VISUAL EDITOR PANEL -->
    <!-- Positioned absolutely to the right of the sidebar on desktop, full screen on mobile -->
    <div id="visual-editor-panel" 
        class="fixed md:absolute top-0 left-0 md:left-96 w-full md:w-[600px] h-full bg-white shadow-2xl z-20 transform -translate-x-[120%] md:-translate-x-full border-r border-gray-200 flex flex-col">
        
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50">
            <h2 class="text-lg font-bold text-gray-800 flex items-center">
                <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                Advanced Style Editor
            </h2>
            <button id="close-editor-btn" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <!-- 3-Column Layout Container -->
        <div class="flex-grow flex overflow-hidden">
            
            <!-- Column 1: Feature Type -->
            <div id="col-feature" class="w-1/3 border-r border-gray-200 flex flex-col bg-white">
                <div class="p-2 bg-gray-100 border-b border-gray-200 text-xs font-bold text-gray-500 uppercase">1. Feature</div>
                <div class="overflow-y-auto flex-grow" id="feature-list">
                    <!-- All -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="0">All <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(0)</span></div>
                    
                    <!-- Administrative -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="1">Administrative <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="17">↳ Country <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(17)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="18">↳ Province <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(18)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="19">↳ Locality <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(19)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="20">↳ Neighborhood <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(20)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="21">↳ Land Parcel <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(21)</span></div>

                    <!-- Landscape -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="5">Landscape <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(5)</span></div>
                    <!-- MAN MADE (Reverted to simple) -->
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600 font-medium" data-value="81">↳ Man Made <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(81)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="82">↳ Natural <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(82)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="83">↳ Landcover <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(83)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="84">↳ Terrain <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(84)</span></div>

                    <!-- POI -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="2">Points of Interest <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(2)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="33">↳ Attraction <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(33)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="34">↳ Business <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(34)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="35">↳ Government <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(35)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="36">↳ Medical <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(36)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="40">↳ Park <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(40)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="37">↳ Place of Worship <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(37)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="38">↳ School <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(38)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="39">↳ Sports Complex <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(39)</span></div>

                    <!-- Road -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="3">Road (All) <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(3)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="49">↳ Highway <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(49)</span></div>
                    <div class="selectable-item p-2 pl-12 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-500 italic" data-value="1298">↳ Controlled Access <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1298)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="50">↳ Arterial (Main Roads) <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(50)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="51">↳ Local (Streets) <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(51)</span></div>

                    <!-- Transit -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="4">Transit <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(4)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="65">↳ Line <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(65)</span></div>
                    <div class="selectable-item p-2 pl-8 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="66">↳ Station <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(66)</span></div>
                    <div class="selectable-item p-2 pl-12 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-500 italic" data-value="1058">↳ Airport <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1058)</span></div>
                    <div class="selectable-item p-2 pl-12 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-500 italic" data-value="1059">↳ Bus <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1059)</span></div>
                    <div class="selectable-item p-2 pl-12 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-500 italic" data-value="1060">↳ Rail <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1060)</span></div>

                    <!-- Water -->
                    <div class="selectable-item p-3 text-sm font-bold cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="6">Water <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(6)</span></div>

                    <!-- OTHER / EXPERIMENTAL -->
                    <div class="p-2 bg-gray-50 border-t border-b border-gray-200 text-xs font-bold text-gray-500 uppercase mt-2">Other / Experimental</div>
                    
                    <!-- Dynamic Items Container -->
                    <div id="custom-items-list">
                        <div class="selectable-item p-2 pl-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="1314">Mountain Lighting/Sunlight <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1314)</span></div>
                        <div class="selectable-item p-2 pl-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent text-gray-600" data-value="1313">Terrain/Cover <span class="text-[10px] text-gray-400 font-normal ml-1 pointer-events-none">(1313)</span></div>
                    </div>
                    
                    <!-- CUSTOM ID INPUT -->
                    <div class="p-2 pl-3 text-xs border-l-4 border-transparent mt-2">
                        <div class="flex items-center space-x-1">
                            <span class="text-gray-500 whitespace-nowrap">Custom ID:</span>
                            <input type="number" id="custom-feature-id" class="w-12 p-1 border rounded text-xs" placeholder="99">
                            <button id="set-custom-id-btn" class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs hover:bg-indigo-200">Set</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column 2: Element Type -->
            <div id="col-element" class="w-1/3 border-r border-gray-200 flex flex-col bg-white step-disabled">
                <div class="p-2 bg-gray-100 border-b border-gray-200 text-xs font-bold text-gray-500 uppercase">2. Element</div>
                
                <!-- RENAME INPUT FOR CUSTOM FEATURES -->
                <div id="feature-rename-container" class="p-2 border-b border-gray-200 bg-yellow-50 hidden">
                    <label class="block text-[10px] font-bold text-yellow-800 mb-1">Rename Feature</label>
                    <input type="text" id="feature-rename-input" class="w-full p-1 text-xs border rounded bg-white" placeholder="Enter name...">
                </div>

                <div class="overflow-y-auto flex-grow" id="element-list">
                    <!-- JS will populate -->
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="a">All</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="g">Geometry (Body)</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="g.f">Geo. Fill (Surface)</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="g.s">Geo. Stroke (Outlines)</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="l">Labels</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="l.t">Text</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="l.t.f">Text Fill</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="l.t.s">Text Stroke</div>
                    <div class="selectable-item p-3 text-sm cursor-pointer hover:bg-gray-50 border-l-4 border-transparent" data-value="l.i">Icon</div>
                </div>
            </div>

            <!-- Column 3: Stylers -->
            <div id="col-stylers" class="w-1/3 flex flex-col bg-gray-50 overflow-y-auto p-3 space-y-4 step-disabled">
                <div class="text-xs font-bold text-gray-500 uppercase border-b pb-1">3. Stylers</div>
                
                <!-- Visibility -->
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Visibility</label>
                    <select id="styler-visibility" class="w-full p-1.5 text-sm border rounded hover:border-gray-400">
                        <option value="">Inherit</option>
                        <option value="on">On</option>
                        <option value="off">Off</option>
                        <option value="s">Simplified</option>
                    </select>
                </div>

                <!-- Color -->
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Color</label>
                    <div class="flex items-center space-x-2">
                        <div class="relative">
                            <input type="color" id="styler-color" class="absolute inset-0 opacity-0 w-full h-full cursor-pointer">
                            <div id="color-preview-box" class="w-8 h-8 rounded-md border border-gray-300 shadow-sm bg-white flex items-center justify-center transition-colors">
                                <!-- Optional icon or gradient fallback -->
                            </div>
                        </div>
                        <input type="text" id="styler-color-text" class="flex-1 p-1.5 text-sm border rounded font-mono hover:border-gray-400 focus:ring-1 focus:ring-indigo-500 outline-none" placeholder="#RRGGBB">
                    </div>
                </div>

                <!-- Weight -->
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Weight (0-8)</label>
                    <input type="number" id="styler-weight" class="w-full p-1.5 text-sm border rounded hover:border-gray-400" step="0.1" min="0" max="8" placeholder="e.g., 1.5">
                </div>

                <!-- Saturation -->
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Saturation (-100 to 100)</label>
                    <input type="range" id="styler-saturation" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="-100" max="100" value="0">
                    <div class="text-xs text-right text-gray-500 mt-1" id="sat-val">0</div>
                </div>

                <!-- Lightness -->
                <div>
                    <label class="block text-xs font-medium text-gray-700 mb-1">Lightness (-100 to 100)</label>
                    <input type="range" id="styler-lightness" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="-100" max="100" value="0">
                    <div class="text-xs text-right text-gray-500 mt-1" id="light-val">0</div>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="p-4 border-t border-gray-200 bg-white flex justify-end space-x-2">
            <button id="add-rule-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 shadow-md text-sm w-full disabled:opacity-50 disabled:cursor-not-allowed">
                + Add Rule to Map
            </button>
        </div>
    </div>

    <!-- Right: Map Area -->
    <div id="map-container" class="flex-1 relative bg-gray-200">
        <div id="map" class="h-full w-full outline-none"></div>
        <button id="toggle-menu-btn" class="md:hidden absolute top-4 left-4 bg-white text-gray-700 p-3 rounded-full shadow-lg z-[999] hover:bg-gray-100 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha2d1-sP3/azT7A1S3uB49X4d34Vw/kL/nFp3d/jE9G7iQ8QeM1A/pE+J9K+33D3L5G4A==" crossorigin=""></script>

    <!-- Application Logic Modules (Updated Path) -->
    <script type="module" src="assets/js/main.js"></script>

</body>
</html>